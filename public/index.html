<!DOCTYPE html>
<html>

<head>
    <title>Real-Time Charts</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <div class="container">
        <h1>Real-Time Charts</h1>
        <div class="chart-options">
            <div class="form-group">
                <label for="chart-type-select">Chart Type:</label>
                <select id="chart-type-select" class="form-control">
                    <option value="realtime">Real-Time</option>
                    <option value="history">History</option>
                </select>
            </div>
        </div>
        <div class="charts">
            <div>
                <canvas id="temperature-chart" width="700" height="300"></canvas>
            </div>
            <div>
                <canvas id="humidity-chart" width="700" height="300"></canvas>
            </div>
        </div>
    </div>

    <script src="js/charts.js"></script>
    <script src="js/app.js"></script>
    <!-- <script>
        // Глобальные переменные для хранения данных и графиков
        let temperatureData = [];
        let humidityData = [];
        let temperatureChart, humidityChart;
        let realtimeInterval, historyInterval;

        function initCharts() {
            if (temperatureChart) {
                temperatureChart.destroy();
            }
            if (humidityChart) {
                humidityChart.destroy();
            }

            const temperatureCtx = document.getElementById('temperature-chart').getContext('2d');
            temperatureChart = new Chart(temperatureCtx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Temperature',
                        borderColor: 'red',
                        backgroundColor: 'rgba(255, 0, 0, 0.2)',
                        fill: true,
                        data: temperatureData
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: {
                            tension: 0 // Отключаем сглаживание линии
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            display: false // Скрываем метки времени на оси x
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            const humidityCtx = document.getElementById('humidity-chart').getContext('2d');
            humidityChart = new Chart(humidityCtx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Humidity',
                        borderColor: 'blue',
                        backgroundColor: 'rgba(0, 0, 255, 0.2)',
                        fill: true,
                        data: humidityData
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: {
                        line: {
                            tension: 0 // Отключаем сглаживание линии
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            display: false // Скрываем метки времени на оси x
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updateHistoryCharts() {
            clearInterval(realtimeInterval); // Остановка интервала для режима Real-Time

            axios.get('api/data?mode=history')
                .then(response => {
                    const data = response.data;

                    if (!temperatureChart) {
                        initCharts();
                    }

                    updateCharts(data);
                })
                .catch(error => {
                    console.log(error);
                    // Обработка ошибки
                });
        }


        // Функция для обновления данных и графиков в режиме History
        function updateRealtimeCharts() {
            clearInterval(historyInterval); // Остановка интервала для режима History

            realtimeInterval = setInterval(async () => {
                try {
                    const response = await axios.get('api/data?mode=latest');
                    const data = response.data;

                    if (!temperatureChart) {
                        initCharts();
                    }

                    updateCharts(data);
                } catch (error) {
                    console.log(error);
                    // Обработка ошибки
                }
            }, 5000);
        }
        // Функция для обновления данных и графиков
        function updateCharts(data) {
            if (Array.isArray(data)) {
                // Обновление данных для графика History
                // Очищаем предыдущие данные
                temperatureData = [];
                humidityData = [];

                // Обрабатываем полученные данные
                for (let i = 0; i < data.length; i++) {
                    const temperature = data[i].temperature;
                    const humidity = data[i].humidity;
                    const timestamp = new Date(data[i].createdAt).getTime();

                    temperatureData.push({
                        x: timestamp,
                        y: temperature
                    });

                    humidityData.push({
                        x: timestamp,
                        y: humidity
                    });
                }

                // Ограничение количества точек на графике
                const maxDataPoints = 100;
                if (temperatureData.length > maxDataPoints) {
                    temperatureData = temperatureData.slice(temperatureData.length - maxDataPoints);
                }
                if (humidityData.length > maxDataPoints) {
                    humidityData = humidityData.slice(humidityData.length - maxDataPoints);
                }

                // Обновляем графики History
                temperatureChart.data.datasets[0].data = temperatureData;
                humidityChart.data.datasets[0].data = humidityData;
                temperatureChart.update();
                humidityChart.update();
            } else {
                // Обновление данных для графика Real-Time
                const temperature = data.temperature;
                const humidity = data.humidity;
                const timestamp = Date.now();

                temperatureData.push({
                    x: timestamp,
                    y: temperature
                });

                humidityData.push({
                    x: timestamp,
                    y: humidity
                });

                // Ограничение количества точек на графике
                const maxDataPoints = 100;
                if (temperatureData.length > maxDataPoints) {
                    temperatureData.shift();
                }
                if (humidityData.length > maxDataPoints) {
                    humidityData.shift();
                }

                // Обновляем графики Real-Time
                temperatureChart.update();
                humidityChart.update();
            }
        }


        // Обработчик события изменения значения в выпадающем списке
        document.getElementById('chart-type-select').addEventListener('change', function () {
            const selectedValue = this.value;

            if (selectedValue === 'realtime') {
                updateRealtimeCharts();
            } else if (selectedValue === 'history') {
                updateHistoryCharts();
            }
        });

        updateRealtimeCharts();
    </script> -->
</body>

</html>